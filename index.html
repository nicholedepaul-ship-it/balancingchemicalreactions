<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Chemistry Balancer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom transitions for smoother UI updates */
        .fade-in { animation: fadeIn 0.3s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        
        input::-webkit-outer-spin-button,
        input::-webkit-inner-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        input[type=number] {
            -moz-appearance: textfield;
        }
    </style>
</head>
<body class="bg-slate-50 font-sans text-slate-800 p-4 sm:p-6 lg:p-8">

    <div class="max-w-4xl mx-auto space-y-8">
        
        <!-- Header -->
        <header class="bg-white rounded-2xl shadow-sm border border-slate-200 p-6">
            <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
                <div>
                    <h1 class="text-3xl font-extrabold text-slate-900 flex items-center gap-3">
                        <!-- Beaker Icon -->
                        <svg class="w-8 h-8 text-blue-600" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M4.5 3h15"/><path d="M6 3v16a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V3"/><path d="M6 14h12"/></svg>
                        Balancing Chemical Reactions
                    </h1>
                    <p class="text-slate-500 mt-2">
                        Balance the equations and master the 5 standard reaction types.
                    </p>
                </div>
                <button id="toggle-defs-btn" class="flex items-center justify-center gap-2 px-4 py-2 bg-blue-50 text-blue-700 rounded-lg hover:bg-blue-100 transition-colors font-medium">
                    <!-- Info Icon -->
                    <svg class="w-4 h-4" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="M12 16v-4"/><path d="M12 8h.01"/></svg>
                    <span id="toggle-text">Review Types</span>
                    <!-- Chevron Down -->
                    <svg id="chevron-icon" class="w-4 h-4 transition-transform" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
            </div>

            <!-- Definitions Container -->
            <div id="definitions-container" class="hidden mt-6 grid gap-4 md:grid-cols-2 lg:grid-cols-3">
                <!-- Injected via JS -->
            </div>
        </header>

        <!-- Problems Container -->
        <div id="app-container" class="space-y-4">
            <!-- Content injected via JS -->
        </div>

        <!-- Footer -->
        <footer class="text-center text-slate-400 text-sm py-8">
            Chemical Balancing Practice • 25 Problems
        </footer>

    </div>

    <script>
        // Data Definitions
        const definitions = [
            { type: "Synthesis", desc: "Two or more substances combine to form a single product.", form: "A + B → AB" },
            { type: "Decomposition", desc: "A single compound breaks down into two or more simpler substances.", form: "AB → A + B" },
            { type: "Single Displacement", desc: "One element replaces another element in a compound.", form: "A + BC → AC + B" },
            { type: "Double Displacement", desc: "Ions of two compounds exchange places in aqueous solution.", form: "AB + CD → AD + CB" },
            { type: "Combustion", desc: "A substance reacts with oxygen, releasing energy (producing CO₂ + H₂O for hydrocarbons).", form: "CxHy + O₂ → CO₂ + H₂O" }
        ];

        const sections = [
            {
                title: "Part I: Synthesis Reactions",
                problems: [
                    { id: 1, level: "Basic", parts: [{ formula: "Na" }, { formula: "Cl2" }], products: [{ formula: "NaCl" }], correct: [2, 1, 2] },
                    { id: 2, level: "Intermediate", parts: [{ formula: "H2" }, { formula: "O2" }], products: [{ formula: "H2O" }], correct: [2, 1, 2] },
                    { id: 3, level: "Advanced", parts: [{ formula: "N2" }, { formula: "H2" }], products: [{ formula: "NH3" }], correct: [1, 3, 2] },
                    { id: 4, level: "Challenging", parts: [{ formula: "Al" }, { formula: "O2" }], products: [{ formula: "Al2O3" }], correct: [4, 3, 2] },
                    { id: 5, level: "Expert", parts: [{ formula: "P4" }, { formula: "O2" }], products: [{ formula: "P4O10" }], correct: [1, 5, 1] }
                ]
            },
            {
                title: "Part II: Decomposition Reactions",
                problems: [
                    { id: 6, level: "Basic", parts: [{ formula: "H2O" }], products: [{ formula: "H2" }, { formula: "O2" }], correct: [2, 2, 1] },
                    { id: 7, level: "Intermediate", parts: [{ formula: "HgO" }], products: [{ formula: "Hg" }, { formula: "O2" }], correct: [2, 2, 1] },
                    { id: 8, level: "Advanced", parts: [{ formula: "H2O2" }], products: [{ formula: "H2O" }, { formula: "O2" }], correct: [2, 2, 1] },
                    { id: 9, level: "Challenging", parts: [{ formula: "KClO3" }], products: [{ formula: "KCl" }, { formula: "O2" }], correct: [2, 2, 3] },
                    { id: 10, level: "Expert", parts: [{ formula: "NaN3" }], products: [{ formula: "Na" }, { formula: "N2" }], correct: [2, 2, 3] }
                ]
            },
            {
                title: "Part III: Single Displacement Reactions",
                problems: [
                    { id: 11, level: "Basic", parts: [{ formula: "Zn" }, { formula: "HCl" }], products: [{ formula: "ZnCl2" }, { formula: "H2" }], correct: [1, 2, 1, 1] },
                    { id: 12, level: "Intermediate", parts: [{ formula: "F2" }, { formula: "NaCl" }], products: [{ formula: "NaF" }, { formula: "Cl2" }], correct: [1, 2, 2, 1] },
                    { id: 13, level: "Advanced", parts: [{ formula: "Al" }, { formula: "Fe2O3" }], products: [{ formula: "Al2O3" }, { formula: "Fe" }], correct: [2, 1, 1, 2] },
                    { id: 14, level: "Challenging", parts: [{ formula: "Cu" }, { formula: "AgNO3" }], products: [{ formula: "Cu(NO3)2" }, { formula: "Ag" }], correct: [1, 2, 1, 2] },
                    { id: 15, level: "Expert", parts: [{ formula: "Al" }, { formula: "CuCl2" }], products: [{ formula: "AlCl3" }, { formula: "Cu" }], correct: [2, 3, 2, 3] }
                ]
            },
            {
                title: "Part IV: Double Displacement Reactions",
                problems: [
                    { id: 16, level: "Basic", parts: [{ formula: "AgNO3" }, { formula: "NaCl" }], products: [{ formula: "AgCl" }, { formula: "NaNO3" }], correct: [1, 1, 1, 1] },
                    { id: 17, level: "Intermediate", parts: [{ formula: "KI" }, { formula: "Pb(NO3)2" }], products: [{ formula: "PbI2" }, { formula: "KNO3" }], correct: [2, 1, 1, 2] },
                    { id: 18, level: "Advanced", parts: [{ formula: "FeCl3" }, { formula: "NaOH" }], products: [{ formula: "Fe(OH)3" }, { formula: "NaCl" }], correct: [1, 3, 1, 3] },
                    { id: 19, level: "Challenging", parts: [{ formula: "Ca(OH)2" }, { formula: "H3PO4" }], products: [{ formula: "Ca3(PO4)2" }, { formula: "H2O" }], correct: [3, 2, 1, 6] },
                    { id: 20, level: "Expert", parts: [{ formula: "Al2(SO4)3" }, { formula: "Ca(OH)2" }], products: [{ formula: "Al(OH)3" }, { formula: "CaSO4" }], correct: [1, 3, 2, 3] }
                ]
            },
            {
                title: "Part V: Combustion Reactions",
                problems: [
                    { id: 21, level: "Basic", parts: [{ formula: "CH4" }, { formula: "O2" }], products: [{ formula: "CO2" }, { formula: "H2O" }], correct: [1, 2, 1, 2] },
                    { id: 22, level: "Intermediate", parts: [{ formula: "C3H8" }, { formula: "O2" }], products: [{ formula: "CO2" }, { formula: "H2O" }], correct: [1, 5, 3, 4] },
                    { id: 23, level: "Advanced", parts: [{ formula: "CH3OH" }, { formula: "O2" }], products: [{ formula: "CO2" }, { formula: "H2O" }], correct: [2, 3, 2, 4] },
                    { id: 24, level: "Challenging", parts: [{ formula: "C2H6" }, { formula: "O2" }], products: [{ formula: "CO2" }, { formula: "H2O" }], correct: [2, 7, 4, 6] },
                    { id: 25, level: "Expert", parts: [{ formula: "C4H10" }, { formula: "O2" }], products: [{ formula: "CO2" }, { formula: "H2O" }], correct: [2, 13, 8, 10] }
                ]
            }
        ];

        // Helper: Format Formula (H2O -> H₂O)
        function formatHTMLFormula(formula) {
            // Split by numbers
            const parts = formula.split(/(\d+)/).filter(Boolean);
            let html = '';
            parts.forEach(part => {
                if (/^\d+$/.test(part)) {
                    html += `<sub class="text-xs">${part}</sub>`;
                } else {
                    html += `<span>${part}</span>`;
                }
            });
            return html;
        }

        // Initialize App
        function init() {
            renderDefinitions();
            renderApp();
            setupEventListeners();
        }

        // 1. Render Definitions
        function renderDefinitions() {
            const container = document.getElementById('definitions-container');
            definitions.forEach(def => {
                const card = document.createElement('div');
                card.className = "p-4 rounded-xl bg-slate-50 border border-slate-100 hover:border-blue-200 transition-colors fade-in";
                card.innerHTML = `
                    <h3 class="font-bold text-blue-800 mb-1">${def.type}</h3>
                    <p class="text-xs text-slate-500 font-mono mb-2 bg-white inline-block px-1 rounded">${def.form}</p>
                    <p class="text-sm text-slate-600 leading-snug">${def.desc}</p>
                `;
                container.appendChild(card);
            });
        }

        // 2. Render Main App Content
        function renderApp() {
            const container = document.getElementById('app-container');
            
            sections.forEach((section, sIdx) => {
                const sectionDiv = document.createElement('div');
                sectionDiv.className = "space-y-4";
                
                // Section Title
                const title = document.createElement('h2');
                title.className = "text-xl font-bold text-slate-700 border-b-2 border-blue-100 pb-2 flex items-center";
                title.innerHTML = `
                    <span class="bg-blue-600 text-white text-xs font-bold px-2 py-1 rounded mr-3 uppercase tracking-wider">
                        Part ${sIdx + 1}
                    </span>
                    ${section.title.split(': ')[1]}
                `;
                sectionDiv.appendChild(title);

                // Grid for problems
                const problemGrid = document.createElement('div');
                problemGrid.className = "grid gap-4";

                section.problems.forEach(problem => {
                    const card = document.createElement('div');
                    card.id = `problem-${problem.id}`;
                    card.className = "relative group bg-white rounded-xl border-l-4 border-l-blue-500 p-5 shadow-sm hover:shadow-md transition-all";
                    
                    // Top Bar (Level + Status)
                    const topBar = document.createElement('div');
                    topBar.className = "flex flex-col sm:flex-row justify-between items-start sm:items-center mb-4 gap-2";
                    topBar.innerHTML = `
                        <span class="text-xs font-semibold text-slate-400 uppercase tracking-widest">
                            Level ${problem.id % 5 === 0 ? 5 : problem.id % 5}: ${problem.level}
                        </span>
                        <span id="status-${problem.id}" class="hidden flex items-center font-bold text-sm px-2 py-1 rounded-full"></span>
                    `;
                    card.appendChild(topBar);

                    // Equation Area
                    const equationDiv = document.createElement('div');
                    equationDiv.className = "flex flex-wrap items-center gap-2 sm:gap-3 mb-6 justify-center sm:justify-start";

                    let inputCount = 0;

                    // Helper to create input+formula group
                    const createPart = (part, idx, isProduct) => {
                        const wrapper = document.createElement('div');
                        wrapper.className = "flex items-center gap-1 sm:gap-2";
                        
                        // Add plus sign if not first in list
                        if (idx > 0) {
                            const plus = document.createElement('span');
                            plus.className = "text-gray-500 font-bold";
                            plus.textContent = "+";
                            equationDiv.appendChild(plus);
                        }

                        // Input field
                        const input = document.createElement('input');
                        input.type = "text";
                        input.inputMode = "numeric";
                        input.className = "w-10 h-10 sm:w-12 sm:h-12 text-center border-2 border-gray-300 rounded-lg shadow-sm focus:outline-none focus:ring-2 focus:border-blue-500 focus:ring-blue-200 transition-colors input-problem-" + problem.id;
                        input.placeholder = "1";
                        input.dataset.problemId = problem.id;
                        input.dataset.index = inputCount;
                        
                        // Formula Text
                        const formulaSpan = document.createElement('span');
                        formulaSpan.className = "text-lg sm:text-xl font-medium text-gray-700 tracking-wide font-mono";
                        formulaSpan.innerHTML = formatHTMLFormula(part.formula);

                        wrapper.appendChild(input);
                        wrapper.appendChild(formulaSpan);
                        equationDiv.appendChild(wrapper);
                        
                        inputCount++;
                    };

                    // Reactants
                    problem.parts.forEach((p, i) => createPart(p, i, false));

                    // Arrow
                    const arrow = document.createElement('div');
                    arrow.className = "mx-2 text-slate-400";
                    arrow.innerHTML = `<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="5" y1="12" x2="19" y2="12"></line><polyline points="12 5 19 12 12 19"></polyline></svg>`;
                    equationDiv.appendChild(arrow);

                    // Products
                    problem.products.forEach((p, i) => createPart(p, i, true));

                    card.appendChild(equationDiv);

                    // Controls
                    const controls = document.createElement('div');
                    controls.className = "flex justify-end";
                    
                    const btn = document.createElement('button');
                    btn.textContent = "Check";
                    btn.className = "flex items-center gap-2 px-6 py-2 rounded-lg font-semibold transition-all bg-blue-600 text-white hover:bg-blue-700 active:scale-95 shadow-lg shadow-blue-200";
                    btn.onclick = () => checkAnswer(problem.id, problem.correct, btn);
                    
                    controls.appendChild(btn);
                    card.appendChild(controls);

                    problemGrid.appendChild(card);
                });

                sectionDiv.appendChild(problemGrid);
                container.appendChild(sectionDiv);
            });
        }

        // 3. Logic: Check Answer
        function checkAnswer(id, correctAnswers, btn) {
            const inputs = document.querySelectorAll(`.input-problem-${id}`);
            const userValues = Array.from(inputs).map(input => {
                const val = input.value.trim();
                // Treat empty as 1, otherwise parse int
                return val === '' ? 1 : parseInt(val);
            });

            // Compare arrays
            let isCorrect = true;
            if (userValues.length !== correctAnswers.length) isCorrect = false;
            else {
                for(let i=0; i<correctAnswers.length; i++) {
                    if (userValues[i] !== correctAnswers[i]) {
                        isCorrect = false;
                        break;
                    }
                }
            }

            updateProblemStatus(id, isCorrect, btn, inputs);
        }

        // 4. Update UI based on result
        function updateProblemStatus(id, isCorrect, btn, inputs) {
            const card = document.getElementById(`problem-${id}`);
            const statusSpan = document.getElementById(`status-${id}`);

            if (isCorrect) {
                // Update Card Style
                card.classList.remove('border-l-blue-500', 'border-l-red-500');
                card.classList.add('border-l-green-500', 'shadow-green-100');
                
                // Update Inputs
                inputs.forEach(input => {
                    input.disabled = true;
                    input.classList.remove('border-gray-300', 'border-red-500', 'bg-red-50');
                    input.classList.add('border-green-500', 'bg-green-50', 'text-green-700', 'font-bold');
                });

                // Update Status Text
                statusSpan.classList.remove('hidden', 'text-red-500', 'bg-red-50');
                statusSpan.classList.add('text-green-600', 'bg-green-50');
                statusSpan.innerHTML = `
                    <svg class="w-4 h-4 mr-1" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>
                    Balanced
                `;

                // Update Button
                btn.textContent = "Solved";
                btn.classList.remove('bg-blue-600', 'hover:bg-blue-700', 'shadow-blue-200');
                btn.classList.add('bg-gray-100', 'text-gray-400', 'cursor-default');
                btn.disabled = true;

            } else {
                // Incorrect logic
                card.classList.remove('border-l-blue-500');
                card.classList.add('border-l-red-500'); // temporary red flash could be added here

                // Update Inputs (Error state)
                inputs.forEach(input => {
                    input.classList.remove('border-gray-300');
                    input.classList.add('border-red-500', 'bg-red-50');
                });

                // Update Status Text
                statusSpan.classList.remove('hidden', 'text-green-600', 'bg-green-50');
                statusSpan.classList.add('text-red-500', 'bg-red-50', 'animate-pulse');
                statusSpan.innerText = "Try Again";
                
                // Reset inputs to normal color on next interaction
                inputs.forEach(input => {
                    input.addEventListener('input', function() {
                        this.classList.remove('border-red-500', 'bg-red-50');
                        this.classList.add('border-gray-300');
                        statusSpan.classList.add('hidden');
                    }, { once: true });
                });
            }
        }

        // 5. Setup Toggle and other global listeners
        function setupEventListeners() {
            const toggleBtn = document.getElementById('toggle-defs-btn');
            const defsContainer = document.getElementById('definitions-container');
            const toggleText = document.getElementById('toggle-text');
            const chevron = document.getElementById('chevron-icon');

            toggleBtn.addEventListener('click', () => {
                const isHidden = defsContainer.classList.contains('hidden');
                
                if (isHidden) {
                    defsContainer.classList.remove('hidden');
                    toggleText.textContent = "Hide Review";
                    chevron.style.transform = "rotate(180deg)";
                } else {
                    defsContainer.classList.add('hidden');
                    toggleText.textContent = "Review Types";
                    chevron.style.transform = "rotate(0deg)";
                }
            });
        }

        // Run
        window.onload = init;

    </script>
</body>
</html>
